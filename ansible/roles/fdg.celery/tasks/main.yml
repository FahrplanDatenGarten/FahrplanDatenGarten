---
- name: Create celery user
  user:
    name: celery
    comment: celery

- name: Add celeryd service template
  template:
    src: celeryd.service.j2
    dest: /etc/systemd/system/celeryd.service

- name: Add tmpfiles/celeryd config template
  template:
    src: tmpfiles_celeryd.conf.j2
    dest: /etc/tmpfiles.d/celeryd.conf

- name: Ensure celeryd service is enabled and started
  systemd:
    daemon_reload: yes
    name: celeryd
    enabled: yes
    state: started

- name: Add celerybeat service template
  template:
    src: celerybeat.service.j2
    dest: /etc/systemd/system/celerybeat.service

- name: Ensure celerybeat service is enabled and started
  systemd:
    daemon_reload: yes
    name: celerybeat
    enabled: yes
    state: started