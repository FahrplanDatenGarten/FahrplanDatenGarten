---
- name: Clone repository from GitHub
  git:
    repo: https://github.com/Jugendhackt/FahrplanDatenGarten.git
    dest: /opt/fdg
    force: yes
    recursive: yes
  register: fdg_app_updated
  notify:
    - collect django statics
    - migrate database

- name: Install pip requirements
  pip:
    requirements: /opt/fdg/requirements.txt
    virtualenv: /opt/fdg/.venv
    virtualenv_command: /usr/bin/python3 -m venv
    extra_args: --upgrade

- name: copy app configuration
  template:
    src: env.cfg.j2
    dest: /opt/fdg/FahrplanDatenGarten/env.cfg
